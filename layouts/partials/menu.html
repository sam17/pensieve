{{ if .Site.Menus.main }}
<nav class="l-nav p-menu">
  <ul class="p-menu__lists">
    {{ range .Site.Menus.main.ByWeight }}
      {{ if .HasChildren }}
        <li class="p-menu__listitem p-menu__parent">
          <span>{{ .Name }}</span>
          <ul>
            {{ range .Children }}
              <li class="p-menu__listitem p-menu__child"><a href="{{ .URL | relLangURL }}">{{ .Name }}</a></li>
            {{ end }}
          </ul>
        </li>
      {{ else }}
      <li class="p-menu__listitem">
        {{ $currentPage := $ }}
        {{ $menuURL := strings.TrimSuffix "/" (.URL | relLangURL) }}
        {{ $currentURL := strings.TrimSuffix "/" $currentPage.RelPermalink }}
        {{ $isActive := false }}

        {{/* Handle root path specially */}}
        {{ if eq $menuURL "" }}
          {{ $menuURL = "/" }}
        {{ end }}
        {{ if eq $currentURL "" }}
          {{ $currentURL = "/" }}
        {{ end }}

        {{/* Check if this menu item is active */}}
        {{ if eq $menuURL "/" }}
          {{/* For home, only active if current is exactly / */}}
          {{ $isActive = eq $currentURL "/" }}
        {{ else }}
          {{/* For other pages, check exact match or prefix match */}}
          {{ $isActive = or (eq $currentURL $menuURL) (hasPrefix $currentURL (printf "%s/" $menuURL)) }}
        {{ end }}
        <a href="{{ .URL }}" {{ if $isActive }}class="active"{{ end }}>
          {{- .Name -}}
        </a>
      </li>
      {{ end }}
    {{ end }}
  </ul>
</nav>
{{ end }}
